<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jp.levtech.rookie.tutorial.repository.mybatis.LoginUserMapper">

  <select id="findByUserName" resultType="jp.levtech.rookie.tutorial.model.LoginUser">
    SELECT
      User_id,
      user_name,
      password,
      enabled
    FROM
      login_users
    WHERE
      user_name = #{userName}
  </select>

  <insert id="register">
    INSERT INTO login_users(
      user_name,
      password,
      enabled
    ) VALUES (
      #{userName},
      #{password},
      #{enabled}
    )
  </insert>

  <!-- 重複チェック: 大文字小文字や前後スペースを無視するなら TRIM と LOWER を使う -->
  <select id="countByUserName" parameterType="string" resultType="int">
    SELECT COUNT(*)
    FROM login_users
    WHERE LOWER(TRIM(user_name)) = LOWER(TRIM(#{userName}))
  </select>

  <!-- user_name（前後空白/大文字小文字を無視）から user_id を1件取得 -->
  <select id="findIdByUserName"
          parameterType="java.lang.String"
          resultType="long">
    SELECT user_id
    FROM login_users
    WHERE LOWER(TRIM(user_name)) = LOWER(TRIM(#{userName}))
    LIMIT 1
  </select>

</mapper>
